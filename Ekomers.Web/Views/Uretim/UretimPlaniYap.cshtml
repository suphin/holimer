@model UretimVM
@{
    ViewData["Title"] = "Üretim Planlama";
    ViewData["Description"] = "Üretim Planlama - Reçete";

}
<style>
    /* Mouse ile üzerine gelindiğinde arka plan rengini değiştir */
    #EklenenUrunlerTablo tbody tr:hover {
        background-color: #f0f0f0;
    }
</style>
<style>


    #EklenenUrunlerTablo th {
        height: 18px !important;
        font-size: 11px !important;
        padding: 2px !important;
    }

    #EklenenUrunlerTablo td {
        height: 18px !important;
        font-size: 11px !important;
        padding: 4px !important;
    }
</style>

<div class="card card-custom">
    <div class="card-header card-header-tabs-line">
        <div class="card-title">


            <h3 class="card-label">@Model.ModalTitle</h3>
        </div>
        <div class="card-toolbar">

            <ul class="nav nav-tabs nav-bold nav-tabs-line">
                <li class="nav-item">
                    <a class="nav-link active" data-toggle="tab" href="#kt_tab_pane_1_4">
                        <span class="nav-icon"><i class="flaticon2-search"></i></span>
                        <span class="nav-text">Detaylar</span>
                    </a>
                </li>
           

            </ul>
        </div>
    </div>
    <div class="card-body">
        <div class="tab-content">
            <div class="tab-pane fade show active" id="kt_tab_pane_1_4" role="tabpanel" aria-labelledby="kt_tab_pane_1_4">
                <form asp-controller="@Model.ControllerName" asp-action="UretimPlaniYap" method="post" name="_VeriEkle2" id="_VeriEkle2">
                   
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="form-group row">

                                <div class="col-lg-12 mb-2">
                                    <label asp-for="UrunAd" class="control-label"></label>
                                    <input asp-for="UrunAd" class="form-control form-control-sm" />
                                    <span asp-validation-for="UrunAd" class="text-danger"></span>
                                </div>
                                <div class="col-lg-12 mb-2">
                                    <label asp-for="Not" class="control-label"></label>
                                    <textarea asp-for="Not" type="text" class="form-control form-control-sm" rows="2" required></textarea>
                                    <span asp-validation-for="Not" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-lg-4 mb-2">
                                    <label asp-for="SiparisTarihi" class="control-label"></label>
                                    <input asp-for="SiparisTarihi" class="form-control form-control-sm" type="date" />
                                    <span asp-validation-for="SiparisTarihi" class="text-danger"></span>
                                </div>
                                <div class="col-lg-4 mb-2">
                                    <label asp-for="PartiNo" class="control-label"></label>
                                    <input asp-for="PartiNo" class="form-control form-control-sm" />
                                    <span asp-validation-for="PartiNo" class="text-danger"></span>
                                </div>
                                <div class="col-lg-4 mb-2">
                                    <label asp-for="TerminSuresi" class="control-label"></label>
                                    <input asp-for="TerminSuresi" class="form-control form-control-sm" />
                                    <span asp-validation-for="TerminSuresi" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-lg-12">
                                    <label asp-for="Uretici" class="control-label"></label>
                                    <select asp-for="UreticiID" class="kt_select2" data-live-search="true" data-size="5" asp-items="@(new SelectList(ViewBag.UreticiListe,"ID","Ad"))"></select>
                                    <span asp-validation-for="Uretici" class="text-danger"></span>
                                </div>
                               
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="form-group">
                                <div class="col-lg-12">
                                  <h4>
                                        Üretim Parametreleri 
                                  </h4>  
                                    <div>
                                       @*  @foreach (var parametre in parametreler)
                                        {
                                            var isChecked = seciliParametreIdler.Contains(parametre.ID);

                                            <div class="form-check">
                                                <input type="checkbox"
                                                       name="SeciliParametreler"
                                                       value="@parametre.ID"
                                                       class="form-check-input"
                                                       id="parametre_@parametre.ID"
                                                       @(isChecked ? "checked" : "") />
                                                <label class="form-check-label" for="parametre_@parametre.ID">
                                                    @parametre.Ad
                                                </label>
                                            </div>
                                        } *@
                                      @*   @{
                                            var parametreler = ViewBag.ReceteParametreListe;
                                            var seciliParametreIdler = Model.ReceteParametreDegerListe?.Select(x => x.ParametreID).ToList() ?? new List<int>();
                                        }
                                        @foreach (var parametre in parametreler)
                                        {
                                            var isChecked = seciliParametreIdler.Contains(parametre.ID);

                                           
                                            if (isChecked)
                                                {
                                                <div class="form-group row mb-2">
                                                    <label class="col-sm-4 col-form-label">@parametre.Ad</label>
                                                    <div class="col-sm-4">
                                                       
                                                        <input type="text"
                                                               name="UretimParametreDeger[@parametre.ID]" 
                                                               class="form-control form-control-sm text-right"
                                                               placeholder="Değer giriniz..." />
                                                    </div>
                                                </div>
                                                }
                                        } *@

                                        @{
                                            var parametreler = ViewBag.ReceteParametreListe as List<ReceteParametre>;
                                            var seciliParametreIdler = Model.ReceteParametreDegerListe?.Select(x => x.ParametreID).ToList() ?? new List<int>();
                                            var index = 0;
                                        }

                                        @foreach (var parametre in parametreler)
                                        {
                                            var isChecked = seciliParametreIdler.Contains(parametre.ID);

                                            if (isChecked)
                                            {
                                                <div class="form-group row mb-2">
                                                    <label class="col-sm-4 col-form-label">@parametre.Ad</label>
                                                    <div class="col-sm-4">
                                                        <input type="hidden" name="UretimParametreDeger[@index].ParametreID" value="@parametre.ID" />
                                                        <input type="text"
                                                               name="UretimParametreDeger[@index].Deger"
                                                               class="form-control form-control-sm text-right"
                                                               placeholder="Değer giriniz..." />
                                                    </div>
                                                </div>

                                                index++;
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                 
                    <div id="UrunlerDiv">
                            <table class="table table-sm table-bordered TableSmallFont" id="EklenenUrunlerTablo" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th>Sıra No</th>
                                        <th>Grup</th>
                                        <th>Alt Grup</th>
                                        <th>Ürün Kodu</th>
                                        <th>Ürün Adı</th>

                                    <th>Miktar</th>
                                    <th>Birim</th>
                                    </tr>
                                </thead>
                                <tbody>
                                @{
                                    var sayac = 1;
                                    index = 0;
                                }
                                @foreach (ReceteUrunlerVM item in Model.ReceteUrunlerVMListe)
                                {
                                    <tr class="@(item.IsDelete ? "deleted" : "")">
                                        <td>@(sayac + 1)</td>
                                        <td>@item.Grup</td>
                                        <td>@item.AltGrup</td>
                                        <td>@item.UrunKod</td>
                                        <td>@item.UrunAd</td>

                                        <td>
                                            <!-- UrunID'yi gizli olarak gönderiyoruz -->
                                            <input type="hidden" name="UretimUrunler[@index].UrunID" value="@item.UrunID" />

                                            <!-- Miktar kullanıcıdan alınacak -->
                                            <input type="text"
                                                   name="UretimUrunler[@index].Deger"
                                                   class="form-control form-control-sm text-right"
                                                   placeholder="Değer giriniz..." />
                                        </td>

                                        <td>@item.BirimAd</td>
                                    </tr>

                                    index++;
                                }
                                   @*  @foreach (ReceteUrunlerVM item in Model.ReceteUrunlerVMListe)
                                    {




                                        <tr class="@(item.IsDelete ? "deleted" : "")">
                                            <td>@sayac</td>
                                            <td>@item.Grup</td>
                                            <td>@item.AltGrup</td>
                                            <td>@item.UrunKod</td>
                                        <td>@item.UrunAd</td>
                                        <td><input type="text" name="urun_@item.UrunID" class="form-control form-control-sm" /></td>
                                            <td>@item.BirimAd</td>
                                         

                                           
                                        </tr>
                                        sayac = sayac + 1;
                                    } *@
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>Üretim Miktarı Hesaplanan Tahmini</td>
                                    <td><input type="text" name="urun_" class="form-control form-control-sm" /></td>
                                    <td></td>
                                  
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>Teslim Alınan Miktar</td>
                                    <td><input type="text" name="urun_" class="form-control form-control-sm" /></td>
                                    <td></td>
                                  
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>Teslim Alınan Tarih</td>
                                    <td><input type="date" name="urun_" class="form-control form-control-sm" /></td>
                                    <td></td>
                                  
                                </tr>
                                </tbody>



                            </table>
                    </div>
 
                    <div class="text-right mt-3">
                        <input type="hidden" asp-for="ID" />
                        <input type="hidden" asp-for="ReceteID" />
                        <input type="hidden" asp-for="UrunID" />
                        <input type="hidden" asp-for="CreateDate" />
                        <input type="hidden" asp-for="UpdateDate" value="@DateTime.Now" />
                        <input type="hidden" asp-for="IsActive" value="true" />
                        <input type="hidden" asp-for="IsDelete" value="false" />
                        <input type="hidden" asp-for="CreateUserID" value="@Model.CreateUserID" />
                        <input type="hidden" asp-for="UpdateUserID" value="@Model.UserID" />
                        <button type="button" class="btn btn-danger" onclick="javascript:history.back()">Geri Dön</button>
                        <button type="submit" class="btn btn-success">Kaydet</button>
                    </div>
                </form>
            </div>
         
        </div>
    </div>
</div>



@{
    await Html.RenderPartialAsync("_PartialModalDosya",
    new AuthorizeCrudVM { Controller = "Recete", HaritaEkle = false });
}


@section JSSection {

  




    <script src="js/select2.js?v=7.0.5"></script>


    <script type="text/javascript">
        // $(document).ready(function () {
            
            
        //     $('#_VeriEkle2').on('submit', function (e) {
        //         e.preventDefault();
        //         var form = $(this);
        //         var actionUrl = form.attr('action');
        //         var formData = form.serialize();
        //         $.ajax({
        //             type: 'POST',
        //             url: actionUrl,
        //             data: formData,
        //             success: function (response) { 
        //                 toastr.success('Kaydetme İşlemi Başarılı', 'Başarılı');

        //             },
        //             error: function (xhr, status, error) {

        //                 toastr.error('Açıklama:' + xhr.responseText, 'Hata!');
        //             }
        //         });
        //     });
        // });

    </script>

    
}


